<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Spreadsheet Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #f8fafc;
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
        }
        .table-container {
            overflow-x: auto;
            max-height: 70vh;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            background: white;
        }
        table {
            border-collapse: collapse;
            min-width: 100%;
        }
        th, td {
            border: 1px solid #e2e8f0;
            padding: 8px;
            min-width: 120px;
            position: relative;
        }
        th {
            background-color: #f1f5f9;
            font-weight: 600;
            text-align: left;
            color: #475569;
            user-select: none;
        }
        td {
            outline: none;
            transition: background-color 0.15s;
        }
        td:focus {
            background-color: #eff6ff;
            box-shadow: inset 0 0 0 2px #3b82f6;
            z-index: 10;
        }
        .row-header {
            background-color: #f1f5f9;
            width: 50px;
            min-width: 50px;
            text-align: center;
            font-size: 0.8rem;
            color: #94a3b8;
        }
        .delete-btn {
            opacity: 0;
            transition: opacity 0.2s;
        }
        th:hover .delete-btn, tr:hover .delete-btn {
            opacity: 1;
        }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-7xl mx-auto">
        <header class="mb-8">
            <h1 class="text-3xl font-bold text-slate-800">Dynamic Spreadsheet</h1>
            <p class="text-slate-500 mt-2">Add/remove rows/cols, paste from Excel/Sheets, or upload a CSV.</p>
        </header>

        <!-- Controls Area -->
        <div class="flex flex-wrap gap-3 mb-6 bg-white p-4 rounded-xl shadow-sm border border-slate-200">
            <button onclick="addRow()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg>
                Add Row
            </button>
            <button onclick="addColumn()" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg>
                Add Column
            </button>
            
            <div class="h-8 w-px bg-slate-200 mx-2"></div>

            <label class="cursor-pointer bg-slate-100 hover:bg-slate-200 text-slate-700 px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 transition border border-slate-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" /></svg>
                Upload CSV
                <input type="file" id="csvFileInput" class="hidden" accept=".csv" onchange="handleFileUpload(event)">
            </label>

            <button onclick="clearTable()" class="bg-white hover:bg-red-50 text-red-600 border border-red-200 px-4 py-2 rounded-lg text-sm font-medium transition">
                Clear All
            </button>

            <div id="statusMessage" class="ml-auto text-sm text-slate-500 self-center hidden">
                Data saved to memory
            </div>
        </div>

        <!-- Table Display -->
        <div class="table-container shadow-sm" id="gridContainer">
            <table id="mainTable">
                <thead id="tableHead">
                    <tr id="headerRow">
                        <th class="row-header">#</th>
                        <th>Column A <button onclick="removeColumn(1)" class="delete-btn ml-2 text-red-400 hover:text-red-600">&times;</button></th>
                        <th>Column B <button onclick="removeColumn(2)" class="delete-btn ml-2 text-red-400 hover:text-red-600">&times;</button></th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- Rows generated by JS -->
                </tbody>
            </table>
        </div>

        <div class="mt-4 p-4 bg-blue-50 border border-blue-100 rounded-lg text-sm text-blue-700">
            <strong>Pro Tip:</strong> You can copy data from Excel or Google Sheets and paste it directly into any cell. The table will automatically expand to fit!
        </div>
    </div>

    <script>
        let columnCount = 2;
        let rowCount = 0;

        // Initialize table with 5 rows
        window.onload = () => {
            for(let i=0; i<5; i++) addRow();
            setupPasteListener();
        };

        function addRow(data = []) {
            rowCount++;
            const tbody = document.getElementById('tableBody');
            const tr = document.createElement('tr');
            
            // Row Number Header
            const th = document.createElement('td');
            th.className = 'row-header flex justify-between items-center px-2';
            th.innerHTML = `<span>${rowCount}</span> <button onclick="removeRow(this)" class="delete-btn text-red-400 hover:text-red-600">&times;</button>`;
            tr.appendChild(th);

            for (let i = 0; i < columnCount; i++) {
                const td = document.createElement('td');
                td.contentEditable = "true";
                td.innerText = data[i] || "";
                tr.appendChild(td);
            }
            tbody.appendChild(tr);
        }

        function addColumn() {
            columnCount++;
            const char = String.fromCharCode(64 + columnCount);
            const headerRow = document.getElementById('headerRow');
            
            // Add to Header
            const th = document.createElement('th');
            const currentIdx = columnCount;
            th.innerHTML = `Column ${columnCount} <button onclick="removeColumn(${currentIdx})" class="delete-btn ml-2 text-red-400 hover:text-red-600">&times;</button>`;
            headerRow.appendChild(th);

            // Add to all existing rows
            const rows = document.getElementById('tableBody').querySelectorAll('tr');
            rows.forEach(row => {
                const td = document.createElement('td');
                td.contentEditable = "true";
                row.appendChild(td);
            });
        }

        function removeRow(btn) {
            const row = btn.closest('tr');
            row.remove();
            reindexRows();
        }

        function removeColumn(index) {
            if (columnCount <= 1) return;
            
            // Remove from header
            const headerRow = document.getElementById('headerRow');
            headerRow.deleteCell(index);
            
            // Remove from all rows
            const rows = document.getElementById('tableBody').querySelectorAll('tr');
            rows.forEach(row => {
                row.deleteCell(index);
            });
            
            columnCount--;
            reindexColumns();
        }

        function reindexRows() {
            const rows = document.getElementById('tableBody').querySelectorAll('tr');
            rowCount = 0;
            rows.forEach((row, i) => {
                rowCount++;
                row.querySelector('.row-header span').innerText = rowCount;
            });
        }

        function reindexColumns() {
            const headers = document.getElementById('headerRow').querySelectorAll('th:not(.row-header)');
            headers.forEach((th, i) => {
                const idx = i + 1;
                th.innerHTML = `Column ${idx} <button onclick="removeColumn(${idx})" class="delete-btn ml-2 text-red-400 hover:text-red-600">&times;</button>`;
            });
        }

        function clearTable() {
            document.getElementById('tableBody').innerHTML = "";
            rowCount = 0;
            for(let i=0; i<5; i++) addRow();
        }

        // --- File Upload Logic ---
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                const text = e.target.result;
                processCSV(text);
            };
            reader.readAsText(file);
        }

        function processCSV(text) {
            const lines = text.split(/\r?\n/);
            if (lines.length === 0) return;

            document.getElementById('tableBody').innerHTML = "";
            rowCount = 0;
            
            // Detect needed columns
            const firstRowData = lines[0].split(',');
            while (columnCount < firstRowData.length) addColumn();

            lines.forEach(line => {
                if (line.trim()) {
                    const data = line.split(',');
                    addRow(data);
                }
            });
            showStatus("CSV Imported successfully");
        }

        // --- Copy/Paste Logic ---
        function setupPasteListener() {
            document.addEventListener('paste', function(e) {
                // Check if target is inside a table cell
                const activeElement = document.activeElement;
                if (activeElement.tagName !== 'TD' || !activeElement.contentEditable) return;

                e.preventDefault();
                
                const text = (e.originalEvent || e).clipboardData.getData('text/plain');
                const rows = text.split(/\r?\n/);
                
                const startRow = activeElement.parentElement;
                const startCellIdx = Array.from(startRow.children).indexOf(activeElement);
                const tbody = document.getElementById('tableBody');
                const allRows = Array.from(tbody.children);
                const startRowIdx = allRows.indexOf(startRow);

                rows.forEach((rowText, rOffset) => {
                    if (!rowText.trim() && rOffset === rows.length - 1) return;
                    
                    const cells = rowText.split('\t'); // Excel/Sheets use tabs
                    let targetRow = allRows[startRowIdx + rOffset];
                    
                    // Add row if paste exceeds current table height
                    if (!targetRow) {
                        addRow();
                        targetRow = tbody.lastElementChild;
                    }

                    cells.forEach((cellText, cOffset) => {
                        const targetCellIdx = startCellIdx + cOffset;
                        
                        // Add column if paste exceeds current table width
                        while (targetCellIdx >= targetRow.children.length) {
                            addColumn();
                        }
                        
                        targetRow.children[targetCellIdx].innerText = cellText;
                    });
                });
                showStatus("Data pasted");
            });
        }

        function showStatus(msg) {
            const status = document.getElementById('statusMessage');
            status.innerText = msg;
            status.classList.remove('hidden');
            setTimeout(() => status.classList.add('hidden'), 3000);
        }
    </script>
</body>
</html>

